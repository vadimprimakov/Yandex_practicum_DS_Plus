# Предсказание стоимости жилья в Калифорнии за 1990 год

В проекте вам нужно обучить модель линейной регрессии на данных о жилье в Калифорнии в 1990 году. 

В колонках датасета содержатся следующие данные:
- longitude — широта;
- latitude — долгота;
- housing_median_age — медианный возраст жителей жилого массива;
- total_rooms — общее количество комнат в домах жилого массива;
- total_bedrooms — общее количество спален в домах жилого массива;
- population — количество человек, которые проживают в жилом массиве;
- households — количество домовладений в жилом массиве;
- median_income — медианный доход жителей жилого массива;
- median_house_value — медианная стоимость дома в жилом массиве;
- ocean_proximity — близость к океану.

План по выполнению проекта
- Инициализировать локальную Spark-сессию.
- Прочитать содержимое файла /datasets/housing.csv.
- Вывести типы данных колонок датасета, использовав методы pySpark.
- Выполнить предобработку данных:
   - Исследовать данные на наличие пропусков и заполните их, выбрав значения по своему усмотрению.
   - Преобразовать колонку с категориальными значениями техникой One hot encoding.
- Построить две модели линейной регрессии на разных наборах данных:
   - используя все данные из файла;
   - используя только числовые переменные, исключив категориальные.
- Для построения модели использовать оценщик LinearRegression из библиотеки MLlib.
- Сравните результаты работы линейной регрессии на двух наборах данных по метрикам RMSE, MAE и R2. Сделать выводы.

## Цель исследования:

На основе данных нужно предсказать медианную стоимость дома в жилом массиве. Обучите модель и сделайте предсказания на тестовой выборке. Для оценки качества модели используйте метрики RMSE, MAE и R2.

## Ход исследования:

Шаг 1. Инициализация локальной Spark-сессию.

Шаг 2. Прочтение содержимого файла 

Шаг 3. Вывод типа данных колонок датасета с использованием методов pySpark.

Шаг 4. Выполнена предобработка данных:
  * Исследованы данные на наличие пропусков, пропуски заполнены медианным значением признака
  * Преобразована колонка с категориальными значениями техникой One hot encoding.

Шаг 5. Построение двух моделей линейной регрессии на разных наборах данных. Для построения модели использован оценщик LinearRegression из библиотеки MLlib:
  * с использованием всех данные из файла;
  * с использованием только числовые переменные, исключив категориальные.

Шаг 6. Сравнение результатов работы линейной регрессии на двух наборах данных по метрикам RMSE, MAE и R2. Оформление выводов.

В рамках данного проекта были использованы принципы работы систем хранения и обработки больших данных с использованием Spark, при работе с ним можно выполнять разные типы задач, не перегружая память одного компьютера. 

## Итог исследования:

В ходе исследования было выявлено, что:
- Среди жилых массивов есть такие, где всего лишь один дом;
- Есть жилые массивы, где всего 3 человека проживает;
- В столбце total_bedrooms есть пропуски, которые были заполнены медианным значением;
- В данных есть выбросы и максимальная цена жилья была намерено ограничена 500 000 тыс.дол.

В процессе загрузки датасетов, пребобработки данных и трансформации признаков было выявлено:
- Проверены пропуски (найдено 207 пропусков в столбец total_bedrooms), строки, в которых есть пропущенные значения были заменены на медианные значения.
- Найдены жилые массивы, в которых живут самые обеспеченные люди, сгруппированы данные по столбцу с категориями удалённости от океана и посчитано среднее значение медианного дохода в жилом массиве. На основе полученных данных можно сделать вывод, что люди с высоким доходом предпочитают селиться в жилых массивах, которые находятся не более чем в часе езды до океана или около залива.
- Исследована зависимость возраста жителей от удалённости жилого массива от океана и сгруппированы данные по двум столбцам: медианный возраст жителей и удалённость от океана, а потом было посчитано, сколько раз встречается то или иное медианное значение возраста в зависимости от удалённости от океана. Построен график, по которому можно предположить, что люди до 20 лет чаще живут в материковой части Калифорнии (INLAND) и в радиусе часа езды до океана. Старшие поколения предпочитают селиться в радиусе часа езды до океана и около залива.
- Созданы несколько новых столбцов с признаками:
   - Отношение количества комнат total_rooms к количеству домовладений households. Столбец rooms_per_household.
   - Отношение количества жителей population к количеству домовладений households. Столбец population_in_household.
   - Отношение количества спален total_bedrooms к общему количеству комнат total_rooms. Столбец bedroom_index

 **При построении модели линейной регрессии на всех данных были получены следующие результаты:**

**RMSE**
- на тренировочных данных = 68707.1 
- на тестовой выборке = 68796.9 

**R2**
- на тренировочных данных = 0.643731 
- на тестовых данных = 0.649562 

**MAE**
- на тренировочных данных: 49610.5 
- на тестовых данных = 50347.9 

**При построении модели линейной регрессии только на числовых данных были получены следующие результаты:**

**RMSE**
- на обучающих данных = 70165.5 
- на тестовых данных = 68223.1 

**R2**
- на тренировочных данных = 0.629273 
- на тестовых данных = 0.653172 

**MAE**
- на тренировочных данных: 51303.5 
- на тестовых данных = 50194.7 

Выведем полученные на тестовом датасете метрики в виде таблицы.

|   | Использованные признаки | RMSE | R2 | MAE |
|--|--|--|--|--|
|1| all_features | 68796.9 | 0.649562 | 50347.9 |
|2| numerical_features_scaled | 70165.5 | 0.653172 | 50194.7 |

В ходе работы было использовано два метода обучения моделей: с формированием вспомогательных датасетов и без. Исходя из полученных результатов, можно сказать, что модель со всеми признаками без исключений обучилась и предсказывает результаты лучше, чем только на числовых. На тестовой выборке было достигнуто значение метрики R2 0.65. 


## Стек технологий:

`pandas`, `matplotlib`, `numpy`, `seaborn`, `pyspark`

## Статус проекта:

Завершен.
