# Определение стоимости автомобилей

Сервис по продаже автомобилей с пробегом «Не бит, не крашен» разрабатывает приложение для привлечения новых клиентов. В нём можно быстро узнать рыночную стоимость своего автомобиля. В вашем распоряжении исторические данные: технические характеристики, комплектации и цены автомобилей. Вам нужно построить модель для определения стоимости.

Заказчику важны:

* качество предсказания;
* скорость предсказания;
* время обучения.

Описание данных

Признаки

- DateCrawled — дата скачивания анкеты из базы
- VehicleType — тип автомобильного кузова
- RegistrationYear — год регистрации автомобиля
- Gearbox — тип коробки передач
- Power — мощность (л. с.)
- Model — модель автомобиля
- Kilometer — пробег (км)
- RegistrationMonth — месяц регистрации автомобиля
- FuelType — тип топлива
- Brand — марка автомобиля
- Repaired — была машина в ремонте или нет
- DateCreated — дата создания анкеты
- NumberOfPictures — количество фотографий автомобиля
- PostalCode — почтовый индекс владельца анкеты (пользователя)
- LastSeen — дата последней активности пользователя

Целевой признак

- Price — цена (евро)

## Цель исследования:

Построение модели для определения рыночной стоимости автомобиля, для оценки качества моделей будет применяться метрика RMSE, ее значение должно быть меньше 2500. Модель LightGBM и CatBoost должна быть построена с помощью градиентного бустинга.

## Ход исследования:

Шаг 1. Загрузка и изучение данных.
В ходе предобработки данных, был изучен датасет на предмет выбросов в данных, наличия дубликатов и пропущенных значений.

- Автомобили с ценой ниже 10 евро в расчет не будут приниматься.
- Исходя из даты формирования объявления, отсечены значения года регистрации позже этой даты, в исследовании принято решение использовать автомобили не страше 67 лет.
- Дата скачивания анкеты, дата создания анкеты, количество фотографий автомобиля, дата последней активности пользователя удалены из набора данных.
- Отсутствующие значения в столбце тип кузова и тип топлива добавлены к категории 'other'.
- Строки с отсутствующими значения в столбце тип коробки передач удалены.
- У признака мощность выявлено 22 тычячи нулевых значений, их и можно считать пропусками. Мощность зачастую зависит от модели и года выпуска, данные заполнены исходя из имеющихся данных, значения для которых данных не хватило были удалены, скорректировы значения больше 340 (разделены на 100), меньше 15 (домножены на 10).
- Пустые значения признака модель выделены в отдельную категорию 'undefined'.
- У признаков пробег и бренд существенных аномалий не выявлено.
- Значение '0' у признака месяц регистрации в нашем случае принят за 'undefined'.
- Выявлен факт того, что в некоторых случаях нам неизвестно была ли машина в ремонте. Данный факт выделен в отдельную категорию, сам признак в количественный, где 0 будет отсутствие ремонта, 1 ремонт был и 2 - неопределено (таким образом можно будет определить вес каждой категории)
- Почтовый индекс. Определено, что все объявления были выставлены в Германии, для того чтобы достоверно определить местоположение собственника автомобиля достаточно двух первых цифр из пяти, но в нашем случае, чтобы избежать большого количества категорий оставим от индекса только первую цифру. Признак заменен на новый с названием Region

Шаг 2. Подготовка выборки для обучения моделей: 
Категориальные признаки трансформированы в цифровой формат, а так же выборки разделены на обучающую и тестовую для проверки качества предсказания моделей в соотношении 75:25.

Шаг 3. Обучение моделей и выбор лучшей:
Для заказчика важны оценки качества предсказания и скорости обучения.
По качеству предсказания на метрике RMSE и распределению значений на графиках лучше всех себя показала модель RandomForestRegressor, в то время как модель CatBoost показала лучший результат по метрике RMSE, у LGBM в отличии от двух других моделей значимость признака - год регистрации (RegistrationYear) занимает второе место уступив мощности Power), а вот модель RidgeRegression оказалась совсем не точной, но в тоже время быстрой. Обучены разные модели, одна из которых — LightGBM, и как минимум одна — не бустинг. Для каждой модели попробовали разные гиперпараметры.

Шаг 4. Анализ времени обучения, времени предсказания и качества моделей:
Для оценки качества моделей применялась метрика RMSE.
Значение метрики RMSE должно было получиться меньше 2500, данное значение достигнуто для всех моделей кроме линейной регресии. Модель LightGBMRegressor и CatBoostRegressor была построена с помощью градиентного бустинга.

Шаг 5. Выбор лучшей модели, опираясь на критерии заказчика, с последующей проверкой её качества на тестовой выборке.

## Итог исследования:

В ходе работы над исследованием были изучены следующие этапы:

- Рассчет вычислительной сложность алгоритмов.
- Обучение моделей алгоритмом градиентного спуска.
- Применение техники градиентного бустинга.

Задача проекта состояла в том, что нужно было построить модель для определения стоимости автомобиля, с лучшими показателями качества предсказания, скорости и времени обучения. Чем ниже RMSE, тем лучше данная модель может «соответствовать» набору данных.

Технология градиетного бустинга сравнивалась с базовыми моделями RidgeRegression и RandomForestRegressor

По итогам обучения моделей на тестовых данных - с небольшим отрывом модель **CatBoostRegressor** показала лучший результат - **1576,63**, однако этот результат был достигнут затратив большее время на обучение предсказаний нежели, например, у случайного леса - **48** секунд. На тестовых данных результат RMSE схож = **1564,10**.

В вашем распоряжении были исторические данные компании "Не бит, не крашен": технические характеристики, комплектации и цены автомобилей. Заказчику рекомендуется строить модель для определения стоимости с помощью **CatBoostRegressor** со следующими гиперпараметрами **learning_rate=0.4**, **n_estimators=1000**, скорость обучения и выдачи предсказаний достаточно высокая, при небольшом расхождении показателей по качеству предсказания (**RMSE 1674.21**) от **LightGBM**, скорость решает.


## Стек технологий:

`pandas`, `matplotlib`, `numpy`, `seaborn`, `GridSearchCV`, `CatBoost`, `LightGBM`

## Статус проекта:

Завершен.
