# Прогнозирование заказов такси

Компания «Чётенькое такси» собрала исторические данные о заказах такси в аэропортах. Чтобы привлекать больше водителей в период пиковой нагрузки, нужно спрогнозировать количество заказов такси на следующий час. Постройте модель для такого предсказания.

Значение метрики *RMSE* на тестовой выборке должно быть не больше 48.

Вам нужно:

1. Загрузить данные и выполнить их ресемплирование по одному часу.
2. Проанализировать данные.
3. Обучить разные модели с различными гиперпараметрами. Сделать тестовую выборку размером 10% от исходных данных.
4. Проверить данные на тестовой выборке и сделать выводы.


Данные лежат в файле `taxi.csv`. Количество заказов находится в столбце `num_orders` (от англ. *number of orders*, «число заказов»).

![Динамика изменений количества заказов](https://github.com/vadimprimakov/Yandex_practicum_DS_Plus/blob/main/17_taxi/17_rolling_mean.png)

Содержание

1.  Подготовка
    1.1  Загрузка библиотек и датасетов
    1.2.  Ресемплирование и проверка на монотонность
2.  Анализ
3.  Обучение
    3.1  DecisionTreeRegressor
    3.2  RandomForestRegressor
    3.3  GradientBoostingRegressor
    3.4  LightGBMRegressor
    3.5  CatBoostRegressor
4.  Тестирование


## Цель исследования:

На основе собранных исторических данных о заказах такси в аэропортах нужно спрогнозировать количество заказов такси на следующий час, чтобы привлекать больше водителей в период пиковой нагрузки. Построить модель для такого предсказания, используя полученные знания о временных рядах.

## Ход исследования:

Шаг 1. Загрузим данные и выполним их ресемплирование по одному часу.

Шаг 2. Проанализируем данные.

Шаг 3. Обучим разные модели с различными гиперпараметрами. Сделаем тестовую выборку размером 10% от исходных данных.

Шаг 4. Проверим данные на тестовой выборке и сделаем выводы.



## Итог исследования:

Загружены данные и выполнено ресемплирование. Проведена предобработка данных. Проанализированы данные.

- Исходные данные содержат 26496 ненулевых строк
- Временной промежуток данных начинается с 2018-03-01 00:00:00 и заканчивается 2018-08-31 23:00:00
- Временной интревал наблюдений составлял 10 минут до ресемплирования по одному часу (данные агрегированы с помощью суммы)
- Пропусков в данных не обнаружено
- Данные расположены в хронологическом порядке (монотонны)

Произведена замена типа данных столбца 'datetime' c object на datetime. 
Установлен индекс таблицы равным столбцу datetime.

**Выбор признаков для моделей**
- Фактор месяца исходя из общего тренда играет роль, так как месяцы лета имеют тренд более высокого роста относительно весенних
- Фактор дня играет также роль, так как имеет тенденцию также относительно месяца расти с течением времени
- Фактор дня недели играет одну из самых важных ролей, потому что данные исходя из него сильно варьируются
- Фактор часа играет самую важную роль, так как у нас прогнозирование на час вперед также на его фоне выделили сезонность ,где есть очень важные часы пиков и минимумов
- Фактор lag нужен для определения интервала на котором обучается модель из целевого признака исходя из желаемого горизонта (если ресэмпл на день, а прогноз строим на неделю вперед ,то lag(7)) в нашем случае прогноз на час вперед ,то берем и lag(1)
- Фактор rolling - это в чем-то схожий признак с lag, но как агрегирующая его функция также полезная для прогнозирования 

Исходя из описанных выше выводов определили какие признаки будем закладывать в модель:

- Месяц и число (по графику тренда);
- Часы (по графику сезонности);
- День недели (по графику остатков);
- Мы делаем прогноз на сутки, поэтому скользящее среднее равно 24 часам;
- Отстающие значения;
- Скользящее среднее;

Cравнение RSME, после проведения кроссвалидацию на обучающей выборке по каждой из рассматриваемых моделей:

|   | RMSE |
|--|--|
|DecisionTree| 28.776 |
|RandomForest| 25.341 |
|GradientBoosting| 25.276 |
|LightGBM| 24.876 |
|CatBoost| 24.511 |

Таким образом мы получили минимальную метрику RSME = 24.51 при обучении модели методом CatBoost. RMSE модели CatBoostRegressor на тестовых данных равна: 40.71.


![Визуализация предсказания по лучшей модели.](https://github.com/vadimprimakov/Yandex_practicum_DS_Plus/blob/main/17_taxi/17_predict.png)


В ходе проекта были обработаны данные о заказах такси.

Для прогноза количества заказов такси были построены 5 моделей предсказания.
Самой эффективной моделью, которая показала минимальную метрику RSME(**40,71**) является модель градиентного бустинга библиотеки **CatBoost** c параметрами **{'depth': 5, 'n_estimators': 500}**, о чем свидетельствует финальный график, на котором точки предсказание и реальных данных хорошо расположены очень близко друг к другу. 

Важными для модели признаками оказались 
- **lag_24**, 
- **hour**, 
- **lag_1**

как и предсказывалось в первичном анализе. 

Требование о значении метрики RMSE (не более 48) выполнено.

## Стек технологий:

`pandas`, `matplotlib`, `numpy`, `seaborn`, `scikit-learn`, `LGBMRegressor`, `CatBoostRegressor`, `statsmodels`, `TimeSeriesSplit`

## Статус проекта:

Завершен.
